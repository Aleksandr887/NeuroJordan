<!DOCTYPE HTML>
<html>

<body>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		async function load() {
			const model = await tf.loadLayersModel('Model_js2/model.json');
			console.log(model.summary())
			return model;
		};


		// скачать npm, tensorflowjs

		// 1. Подумать, как посылать фотку и обрабатывать её через запрос.
		// 2. Поискать как сделать изображение не через путь.
		// 3. При выводе результата предикта выводит ошибку: net::ERR_UNKNOWN_URL_SCHEME

		function predict() {
			model.then(model => {
				let selectedFile = document.getElementById("filePic").value
				var img1 = new Image(224, 224); // TODO
				img1.src = selectedFile;

				let tensor = tf.browser.fromPixels(img1).resizeNearestNeighbor([224, 224]).toFloat()
				let offset = tf.scalar(127.5)
				let batched = tensor.sub(offset).reverse(2).expandDims()
				const res = model.predict(batched)
				alert(res);
			});
		};

		const model = load();  // load model immediately to avoid delay when user clicks 'Predict'
	</script>

	<!-- <input id="userInput" type="text"></input> -->

	<input id="filePic" type="file" />

	<button onclick="predict()">Predict</button>

</body>

</html>